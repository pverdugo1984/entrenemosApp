{
  "version": 3,
  "sources": ["src/app/shared/components/user-profile/user-profile.ts", "src/app/shared/components/user-profile/user-profile.html"],
  "sourcesContent": ["import { Component, Input, inject, EventEmitter, Output } from \"@angular/core\";\nimport { CommonModule } from \"@angular/common\";\nimport { Usuario } from \"../../models/usuario\";\nimport { UsuariosService } from \"../../../core/services/usuarios.service\";\nimport { AuthService } from \"../../../core/services/auth.service\";\nimport { API_BASE_URL } from \"../../../config/api.config\";\n\n@Component({\n  selector: \"app-user-profile\",\n  imports: [CommonModule],\n  templateUrl: \"./user-profile.html\",\n  styleUrl: \"./user-profile.css\",\n})\nexport class UserProfile {\n  @Input() usuario?: Usuario | null;\n  @Output() fotoActualizada = new EventEmitter<Usuario>();\n\n  private usuariosService = inject(UsuariosService);\n  private authService = inject(AuthService);\n\n  subiendo = false;\n  error: string | null = null;\n\n  get nombreUsuario(): string {\n    return this.usuario?.nombre || \"Usuario\";\n  }\n\n  get detallesUsuario(): string {\n    if (!this.usuario) {\n      return \"Inicia sesiÃ³n para ver tu perfil\";\n    }\n    const partes: string[] = [];\n    if (this.usuario.telefono) {\n      partes.push(this.usuario.telefono);\n    }\n    if (this.usuario.rol) {\n      partes.push(this.usuario.rol);\n    }\n    return partes.join(\" | \") || \"Miembro\";\n  }\n\n  get fotoPerfilUrl(): string {\n    if (this.usuario?.fotoPerfil) {\n      // Si la foto empieza con /uploads/, construir la URL del backend sin /api\n      if (this.usuario.fotoPerfil.startsWith(\"/uploads/\")) {\n        // Extraer el puerto y host de API_BASE_URL pero sin /api\n        const baseUrl = API_BASE_URL.replace(\"/api\", \"\");\n        return `${baseUrl}${this.usuario.fotoPerfil}`;\n      }\n      return this.usuario.fotoPerfil;\n    }\n    return \"/assets/user-avatar.png\";\n  }\n\n  onFotoClick(): void {\n    if (!this.usuario?.id) {\n      return;\n    }\n    const input = document.createElement(\"input\");\n    input.type = \"file\";\n    input.accept = \"image/*\";\n    input.onchange = (event: any) => {\n      const file = event.target.files[0];\n      if (file) {\n        this.subirFoto(file);\n      }\n    };\n    input.click();\n  }\n\n  subirFoto(file: File): void {\n    if (!this.usuario?.id) {\n      return;\n    }\n\n    // Validar tamaÃ±o (mÃ¡ximo 5MB)\n    if (file.size > 5 * 1024 * 1024) {\n      this.error = \"La imagen es demasiado grande. MÃ¡ximo 5MB\";\n      setTimeout(() => (this.error = null), 3000);\n      return;\n    }\n\n    // Validar tipo\n    if (!file.type.startsWith(\"image/\")) {\n      this.error = \"El archivo debe ser una imagen\";\n      setTimeout(() => (this.error = null), 3000);\n      return;\n    }\n\n    this.subiendo = true;\n    this.error = null;\n\n    this.usuariosService.subirFotoPerfil(this.usuario.id, file).subscribe({\n      next: (response) => {\n        if (this.usuario) {\n          this.usuario.fotoPerfil = response.fotoPerfil;\n          this.fotoActualizada.emit(this.usuario);\n        }\n        this.subiendo = false;\n      },\n      error: (err) => {\n        console.error(\"Error subiendo foto:\", err);\n        this.error = err.error?.error || \"Error al subir la foto\";\n        this.subiendo = false;\n        setTimeout(() => (this.error = null), 5000);\n      },\n    });\n  }\n}\n", "<section class=\"user-profile\">\n    <div class=\"profile-avatar\">\n        <div class=\"avatar-wrapper\" (click)=\"onFotoClick()\" [class.clickeable]=\"usuario?.id\"\n            [class.subiendo]=\"subiendo\">\n            @if (subiendo) {\n            <div class=\"upload-overlay\">\n                <div class=\"spinner-small\"></div>\n                <span>Subiendo...</span>\n            </div>\n            }\n            <img [src]=\"fotoPerfilUrl\" alt=\"Perfil de usuario\" />\n            @if (usuario?.id && !subiendo) {\n            <div class=\"edit-icon\">ðŸ“·</div>\n            }\n            <div class=\"status-indicator\"></div>\n        </div>\n        @if (error) {\n        <div class=\"error-message-small\">{{ error }}</div>\n        }\n    </div>\n    <div class=\"profile-info\">\n        <h2 class=\"user-name\">{{ nombreUsuario }}</h2>\n        <p class=\"user-details\">{{ detallesUsuario }}</p>\n        @if (usuario && usuario.rol) {\n        <span class=\"user-badge\">{{ usuario.rol }}</span>\n        }\n    </div>\n</section>"],
  "mappings": "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",
  "names": []
}
