{
  "version": 3,
  "sources": ["src/app/core/services/auth.service.ts"],
  "sourcesContent": ["import { Injectable, inject, signal } from \"@angular/core\";\r\nimport { HttpClient } from \"@angular/common/http\";\r\nimport { Router } from \"@angular/router\";\r\nimport { Observable, tap, switchMap } from \"rxjs\";\r\nimport { API_BASE_URL } from \"../../config/api.config\";\r\nimport { LoginRequest, LoginResponse } from \"../../shared/models/auth.model\";\r\nimport { Usuario } from \"../../shared/models/usuario\";\r\n\r\n@Injectable({\r\n  providedIn: \"root\",\r\n})\r\nexport class AuthService {\r\n  private http = inject(HttpClient);\r\n  private router = inject(Router);\r\n  private apiUrl = `${API_BASE_URL}/auth`;\r\n\r\n  // Signals para el token y rol (Angular 20)\r\n  private tokenSignal = signal<string | null>(null);\r\n  public token = this.tokenSignal.asReadonly();\r\n\r\n  private rolSignal = signal<string | null>(null);\r\n  public rol = this.rolSignal.asReadonly();\r\n\r\n  constructor() {\r\n    // Cargar token del localStorage al iniciar\r\n    const savedToken = localStorage.getItem(\"token\");\r\n    const savedRol = localStorage.getItem(\"rol\");\r\n    if (savedToken) {\r\n      this.tokenSignal.set(savedToken);\r\n      this.rolSignal.set(savedRol);\r\n    }\r\n  }\r\n\r\n  login(email: string, password: string): Observable<Usuario> {\r\n    const credentials: LoginRequest = { email, password };\r\n    return this.http\r\n      .post<LoginResponse>(`${this.apiUrl}/login`, credentials)\r\n      .pipe(\r\n        switchMap((response) => {\r\n          // El backend devuelve \"jwt\" o \"token\"\r\n          const token = response.jwt || response.token || \"\";\r\n          this.tokenSignal.set(token);\r\n          this.rolSignal.set(response.rol);\r\n          localStorage.setItem(\"token\", token);\r\n          localStorage.setItem(\"rol\", response.rol);\r\n\r\n          // Obtener el usuario completo para guardar el nombre\r\n          return this.getCurrentUser().pipe(\r\n            tap((usuario) => {\r\n              localStorage.setItem(\"nombre\", usuario.nombre || email);\r\n            })\r\n          );\r\n        })\r\n      );\r\n  }\r\n\r\n  logout(): void {\r\n    this.tokenSignal.set(null);\r\n    this.rolSignal.set(null);\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"rol\");\r\n    localStorage.removeItem(\"nombre\");\r\n    this.router.navigate([\"/login\"]);\r\n  }\r\n\r\n  isAuthenticated(): boolean {\r\n    return this.tokenSignal() !== null;\r\n  }\r\n\r\n  getToken(): string | null {\r\n    return this.tokenSignal();\r\n  }\r\n\r\n  getRol(): string | null {\r\n    return this.rolSignal();\r\n  }\r\n\r\n  // Métodos legacy para compatibilidad\r\n  guardarToken(token: string): void {\r\n    this.tokenSignal.set(token);\r\n    localStorage.setItem(\"token\", token);\r\n  }\r\n\r\n  guardarRol(rol: string): void {\r\n    this.rolSignal.set(rol);\r\n    localStorage.setItem(\"rol\", rol);\r\n  }\r\n\r\n  getCurrentUser(): Observable<Usuario> {\r\n    return this.http.get<Usuario>(`${this.apiUrl}/me`);\r\n  }\r\n\r\n  // Método para obtener el nombre del usuario actual (para chat)\r\n  getNombre(): string | null {\r\n    return localStorage.getItem(\"nombre\");\r\n  }\r\n}\r\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAWM,IAAO,cAAP,MAAO,aAAW;EACd,OAAO,OAAO,UAAU;EACxB,SAAS,OAAO,MAAM;EACtB,SAAS,GAAG,YAAY;;EAGxB,cAAc,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,cAAA,CAAA,IAAA,CAAA,CAAA;EACzC,QAAQ,KAAK,YAAY,WAAU;EAElC,YAAY,OAAsB,MAAI,GAAA,YAAA,CAAA,EAAA,WAAA,YAAA,CAAA,IAAA,CAAA,CAAA;EACvC,MAAM,KAAK,UAAU,WAAU;EAEtC,cAAA;AAEE,UAAM,aAAa,aAAa,QAAQ,OAAO;AAC/C,UAAM,WAAW,aAAa,QAAQ,KAAK;AAC3C,QAAI,YAAY;AACd,WAAK,YAAY,IAAI,UAAU;AAC/B,WAAK,UAAU,IAAI,QAAQ;IAC7B;EACF;EAEA,MAAM,OAAe,UAAgB;AACnC,UAAM,cAA4B,EAAE,OAAO,SAAQ;AACnD,WAAO,KAAK,KACT,KAAoB,GAAG,KAAK,MAAM,UAAU,WAAW,EACvD,KACC,UAAU,CAAC,aAAY;AAErB,YAAM,QAAQ,SAAS,OAAO,SAAS,SAAS;AAChD,WAAK,YAAY,IAAI,KAAK;AAC1B,WAAK,UAAU,IAAI,SAAS,GAAG;AAC/B,mBAAa,QAAQ,SAAS,KAAK;AACnC,mBAAa,QAAQ,OAAO,SAAS,GAAG;AAGxC,aAAO,KAAK,eAAc,EAAG,KAC3B,IAAI,CAAC,YAAW;AACd,qBAAa,QAAQ,UAAU,QAAQ,UAAU,KAAK;MACxD,CAAC,CAAC;IAEN,CAAC,CAAC;EAER;EAEA,SAAM;AACJ,SAAK,YAAY,IAAI,IAAI;AACzB,SAAK,UAAU,IAAI,IAAI;AACvB,iBAAa,WAAW,OAAO;AAC/B,iBAAa,WAAW,KAAK;AAC7B,iBAAa,WAAW,QAAQ;AAChC,SAAK,OAAO,SAAS,CAAC,QAAQ,CAAC;EACjC;EAEA,kBAAe;AACb,WAAO,KAAK,YAAW,MAAO;EAChC;EAEA,WAAQ;AACN,WAAO,KAAK,YAAW;EACzB;EAEA,SAAM;AACJ,WAAO,KAAK,UAAS;EACvB;;EAGA,aAAa,OAAa;AACxB,SAAK,YAAY,IAAI,KAAK;AAC1B,iBAAa,QAAQ,SAAS,KAAK;EACrC;EAEA,WAAW,KAAW;AACpB,SAAK,UAAU,IAAI,GAAG;AACtB,iBAAa,QAAQ,OAAO,GAAG;EACjC;EAEA,iBAAc;AACZ,WAAO,KAAK,KAAK,IAAa,GAAG,KAAK,MAAM,KAAK;EACnD;;EAGA,YAAS;AACP,WAAO,aAAa,QAAQ,QAAQ;EACtC;;qCApFW,cAAW;EAAA;4EAAX,cAAW,SAAX,aAAW,WAAA,YAFV,OAAM,CAAA;;;sEAEP,aAAW,CAAA;UAHvB;WAAW;MACV,YAAY;KACb;;;",
  "names": []
}
